<!DOCTYPE html><html lang="en-US"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if(!e)return localStorage.setItem('theme','system'),d.add('system');if("system"===e){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else d.add(e)}catch(e){}}()</script><title>Bert Transformers, FastAPI, and Toxic Twitter</title><meta name="description" content="A Data Scientist&#x27;s Guide to using FastAPI and BERT to Build a twitter scanner of your tweets."/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Bert Transformers, FastAPI, and Toxic Twitter"/><meta name="og:description" property="og:description" content="A Data Scientist&#x27;s Guide to using FastAPI and BERT to Build a twitter scanner of your tweets."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Bert Transformers, FastAPI, and Toxic Twitter"/><meta name="twitter:description" content="A Data Scientist&#x27;s Guide to using FastAPI and BERT to Build a twitter scanner of your tweets."/><meta name="twitter:creator" content="franciscojarceo"/><link rel="icon" type="image/png" href="/favicon.ico"/><link rel="apple-touch-icon" href="/favicon.ico"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/3f89f357ff8b3d33d919.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3f89f357ff8b3d33d919.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-39418da170c6bb422e22.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.a6f6c255f30e2cc8ab2c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-56b68b45ae4f06abb5d1.js" as="script"/><link rel="preload" href="/_next/static/chunks/5e7de4f36e438e169c5d145e7df90137ae956f1e.c55db21543619f2e3353.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5Bslug%5D-f7cba0a36d81c7b5f6f1.js" as="script"/></head><body><div id="__next"><div class="w-full min-h-screen dark:bg-gray-700 dark:text-white"><div class="max-w-screen-md px-4 py-12 mx-auto antialiased font-body"><header class="flex items-center justify-between  mb-2"><meta name="description" content="My chaotic thoughts on computers, statistics, finance, and data"/><meta name="keywords" content="francisco javier arceo, data science, finance, fintech, engineering, django, python"/><meta property="og:type" content="website"/><meta property="og:title" content="Francisco&#x27;s Random Thoughts"/><meta property="og:locale" content="en_US"/><meta property="og:description" content="My chaotic thoughts on computers, statistics, finance, and data"/><meta property="og:image" content="https://og-image.now.sh/Francisco&#x27;s%20Random%20Thoughts.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="twitter:description" content="My chaotic thoughts on computers, statistics, finance, and data"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="franciscojarceo"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-71125809-1/"></script><script src="/ga.js"></script><div class="max-w-md"><a><a class="text-2xl font-black text-black no-underline font-display dark:text-white" href="/">Francisco Javier Arceo</a></a></div><script></script></header><main style="padding-bottom:10px"><article><header class="mb-8"><h1 class="mb-2 text-6xl font-black leading-none font-display">Bert Transformers, FastAPI, and Toxic Twitter</h1><p class="text-sm">April 11, 2021</p></header><div class="mb-4 prose lg:prose-lg dark:prose-dark"><h2>I will write less frequently</h2><p>Unfortunately, I&#x27;ve been writting a little less frequently than I was hoping to this year; I was targetting about once a week but I think that was (1) a little too frequent and (2) a little too ambitious of me to think I&#x27;d be able to keep up that pace.</p><h2>I will write more quality</h2><p>I&#x27;ll aim to write once or a month or so and hope for higher quality posts.</p><p>In the spirit of more interesting content (and more interesting problems for me to tinker with) in the Twitter thread below I decided I&#x27;d write a blog post on building a webtool that scans a user&#x27;s historical tweets and identifies the highest risk ones.</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Is there an ML type service that can plow through history for potentially problematic tweets?</p>— Matt Galligan (@mg) <a href="https://twitter.com/mg/status/1372923621040082944?ref_src=twsrc%5Etfw">March 19, 2021</a></blockquote> <p>I decided to work on this because (1) it&#x27;s at the intersection of things I really enjoy (nlp, web development, and twittter), (2) I wanted to build a tool that would solve a real problem, and (3) I thought it&#x27;d be fun.</p><h2>Creating a Toxic Twitter Scanner</h2><p>I think this tool can be broken down into 3 sub-problems:</p><ol><li>Creating a web service to handle the front-end user experience (authentication and rendering of data)</li><li>Creating a machine learning model as an endpoint that handles predicting the toxicity/problematicness of a user&#x27;s tweets</li><li>Connecting (1) and (2) and deploying them as a service in an automated way</li></ol><p>There&#x27;s a bunch of stuff in between and technical things to handle, but this is really what I think matters at a high-level, so let&#x27;s dive in!</p><h3>1. Creating a Web Service</h3><p>As a web tool, a user should be able to authenticate with Twitter to scan their tweets and consent to the service using their data (this is to access private tweets). As a starting point, I&#x27;ll probably launch this tool without any authentication and just look at a user&#x27;s public tweets.</p><h3>2. Creating a Machine Learning model as an API</h3><p>This is a reasonably straightforward process as the endpoint will be a wrapper around an existing machine learning library and the goal is to be able to send in some data and get some scores back.</p><h3>3. Connecting a Web Service to an ML API</h3><p>This is an important step. In summary, we want to decouple the user-facing experience from the machine learning because they have very different technical requirements. The compute cluster that&#x27;ll create predictions for the tweets will use much more memory than the user-facing application, so it&#x27;s important to separate them so computing doesn&#x27;t slow down the user experience.</p><h2>Progress on Building a Scanner</h2><p>So far I&#x27;ve been diving into using a pre-trained BERT model developed by <a href="https://laurahanu.github.io">Laura Hanu</a> at <a href="https://www.unitary.ai">Unitary</a> and it&#x27;s been pretty fun. I&#x27;ve been able to score my own tweets and see the behavior of this model and see various implementation details that I&#x27;ll have to be mindful of (I&#x27;ll probably write more on this later).</p><p>I&#x27;ve been tinkering with <a href="https://fastapi.tiangolo.com">FastAPI</a> and figuring out how the <a href="https://fastapi.tiangolo.com/project-generation/">cookie-cutter template</a> works. I don&#x27;t love the way it behaves and there&#x27;s a lot of strong opinions in place which is helpful but imperfect; we&#x27;ll see how my opinion shapes as I spend more time with it.</p><p>I&#x27;m very excited to learn <a href="https://docs.docker.com/get-started/swarm-deploy/">Docker Swarm</a> as it seems like a very promising framework for deploying the model API.</p><p>You can follow my progress on this <a href="https://github.com/franciscojavierarceo/twitter-scan">GitHub repository</a>. Stay tuned as I&#x27;ll be updating this blog with my thoughts as I chip away at this problem.</p><hr/><p><em>Have some feedback? Feel free to <a href="https://twitter.com/franciscojarceo">let me know</a>!</em></p></div></article></main><footer class="text-lg font-light"><div style="padding-top:10px;padding-bottom:10px"><a class="text-lg font-bold" href="/">← Back home</a></div><hr/><div><p>Like this blog? Check out the code on my<!-- --> <a href="https://github.com/franciscojavierarceo/franciscojavierarceo.github.io">GitHub</a>.</p><p>Built with<!-- --> <a href="https://nextjs.org/">Next.js</a> and ☕</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Bert Transformers, FastAPI, and Toxic Twitter","description":"A Data Scientist's Guide to using FastAPI and BERT to Build a twitter scanner of your tweets.","date":"April 11, 2021"},"post":{"content":"\n## I will write less frequently\n\nUnfortunately, I've been writting a little less frequently than I was hoping to this year; I was targetting about once a week but I think that was (1) a little too frequent and (2) a little too ambitious of me to think I'd be able to keep up that pace.\n\n## I will write more quality\n\nI'll aim to write once or a month or so and hope for higher quality posts. \n\nIn the spirit of more interesting content (and more interesting problems for me to tinker with) in the Twitter thread below I decided I'd write a blog post on building a webtool that scans a user's historical tweets and identifies the highest risk ones.\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eIs there an ML type service that can plow through history for potentially problematic tweets?\u003c/p\u003e\u0026mdash; Matt Galligan (@mg) \u003ca href=\"https://twitter.com/mg/status/1372923621040082944?ref_src=twsrc%5Etfw\"\u003eMarch 19, 2021\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\nI decided to work on this because (1) it's at the intersection of things I really enjoy (nlp, web development, and twittter), (2) I wanted to build a tool that would solve a real problem, and (3) I thought it'd be fun.\n\n## Creating a Toxic Twitter Scanner\n\nI think this tool can be broken down into 3 sub-problems:\n1. Creating a web service to handle the front-end user experience (authentication and rendering of data)\n2. Creating a machine learning model as an endpoint that handles predicting the toxicity/problematicness of a user's tweets\n3. Connecting (1) and (2) and deploying them as a service in an automated way\n\nThere's a bunch of stuff in between and technical things to handle, but this is really what I think matters at a high-level, so let's dive in!\n\n### 1. Creating a Web Service\nAs a web tool, a user should be able to authenticate with Twitter to scan their tweets and consent to the service using their data (this is to access private tweets). As a starting point, I'll probably launch this tool without any authentication and just look at a user's public tweets.\n\n### 2. Creating a Machine Learning model as an API\nThis is a reasonably straightforward process as the endpoint will be a wrapper around an existing machine learning library and the goal is to be able to send in some data and get some scores back.\n\n### 3. Connecting a Web Service to an ML API\nThis is an important step. In summary, we want to decouple the user-facing experience from the machine learning because they have very different technical requirements. The compute cluster that'll create predictions for the tweets will use much more memory than the user-facing application, so it's important to separate them so computing doesn't slow down the user experience.\n\n## Progress on Building a Scanner\n\nSo far I've been diving into using a pre-trained BERT model developed by [Laura Hanu](https://laurahanu.github.io) at [Unitary](https://www.unitary.ai) and it's been pretty fun. I've been able to score my own tweets and see the behavior of this model and see various implementation details that I'll have to be mindful of (I'll probably write more on this later).\n\nI've been tinkering with [FastAPI](https://fastapi.tiangolo.com) and figuring out how the [cookie-cutter template](https://fastapi.tiangolo.com/project-generation/) works. I don't love the way it behaves and there's a lot of strong opinions in place which is helpful but imperfect; we'll see how my opinion shapes as I spend more time with it.\n\nI'm very excited to learn [Docker Swarm](https://docs.docker.com/get-started/swarm-deploy/) as it seems like a very promising framework for deploying the model API.\n\nYou can follow my progress on this [GitHub repository](https://github.com/franciscojavierarceo/twitter-scan). Stay tuned as I'll be updating this blog with my thoughts as I chip away at this problem.\n\n---\n*Have some feedback? Feel free to [let me know](https://twitter.com/franciscojarceo)!*\n","excerpt":""},"previousPost":{"slug":"docker-github-actions-and-cron","frontmatter":{"title":"Github Actions, Docker, and the Beloved Cron","description":"Using GitHub Actions to run a Python script inside of a docker container scheduled daily.","date":"March 14, 2021"},"excerpt":"","content":"\nI've written before about my love for [Github Actions](https://franciscojavierarceo.github.io/post/github-actions) and [Docker](https://franciscojavierarceo.github.io/post/docker-for-data-science).\n\nA little over a week ago I tweeted that I was interested in writing a blog post about using Github Actions and Docker to schedule a job to do something interesting, but I didn't have a fun use case. \n\nFortunately, my internet friends delivered.\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003etext me with a pic of your dog\u003c/p\u003e\u0026mdash; Camilo (@camdotbio) \u003ca href=\"https://twitter.com/camdotbio/status/1367856131972947972?ref_src=twsrc%5Etfw\"\u003eMarch 5, 2021\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\nSo I decided to write a quick script to do this, and that's how I spent my Friday evening as my wife and I watched Avengers. 😂\n\nI've provided a link to the [Github Repository](https://github.com/franciscojavierarceo/twitter-cron-demo) with the full code but here's the short instructions if you're interested.\n\n## 1. Register for a developer account on [Twitter](https://developer.twitter.com/en/apply-for-access) and get your API credentials\n\nThis is a pretty easy process and you just sign up and outline what you're doing (it's also free). Note that you'll need to store 4 variables in a `.env` file like below:\n\n    TWITTER_API_KEY=\n    TWITTER_API_SECRET=\n    TWITTER_ACCESS_TOKEN=\n    TWITTER_ACCESS_TOKEN_SECRET=\n\n## 2. Write a Python Script to Tweet a Dog Photo\n\nThis was pretty straightforward thanks to the [Tweepy](https://www.tweepy.org) library in Python and this super random [dog photo API](https://dog.ceo/dog-api/) (God bless the internet).\n\nHere's what that Python code looks like:\n\n```python\nimport os\nimport json\nimport requests\nimport tweepy\n\ndef get_random_dog(filename: str='temp') -\u003e None:\n    r = requests.get('https://dog.ceo/api/breeds/image/random')\n    rd = json.loads(r.content)\n    r2 = requests.get(rd['message'])\n\n    with open(filename, 'wb') as image:\n        for chunk in r2:\n            image.write(chunk)\n\ndef main(message: str, filename: str='temp') -\u003e None:\n    auth = tweepy.OAuthHandler(\n        os.environ.get('TWITTER_API_KEY'), \n        os.environ.get('TWITTER_API_SECRET')\n    )\n    auth.set_access_token(\n        os.environ.get('TWITTER_ACCESS_TOKEN'), \n        os.environ.get(\"TWITTER_ACCESS_TOKEN_SECRET\")\n    )\n    api = tweepy.API(auth)\n    get_random_dog(filename) \n\n    try:\n        api.verify_credentials()\n        print(\"Twitter Authentication Succeeded\")\n    \n        try:\n            api.update_with_media(filename, status=message)\n            print('Tweet successfully sent!')\n\n        except Exception as e:\n            print('Error sending tweet \\n %s' % e)\n    except:\n        print(\"Twitter Authentication Failed\")\n\n\nif __name__ == '__main__':\n    main(\"Hey, @camdotbio! 👋 \\n\\nHere's your daily dog photo!\")\n```\n\n## 3. Create a Docker Container to run the Python Script \n\nThis is a contentious area where some may argue docker is execessive for this but I use different computers with different operating systems so this works for me and I like it. \n\nIn short, I created a [Dockerfile](https://github.com/franciscojavierarceo/twitter-cron-demo/blob/main/Dockerfile) and a [docker-compose](https://github.com/franciscojavierarceo/twitter-cron-demo/blob/main/docker-compose.yml) file where I run the script. The benefit of this is that I don't have to worry about this script not working on my Linux machine or not working on my Mac, it works on both!\n\n## 4. Use a Github Action to Schedule a Cron Job\n\nThis was also straightforward and I've copied the code below:\n\n```yml\nname: Build and Deploy 🚀\n\non:\n    schedule:\n        - cron: '0 15 * * *'\n\njobs:\n    build:\n        runs-on: ubuntu-latest\n\n        steps:\n            - uses: actions/checkout@v2\n\n            - name: Make envfile\n              uses: SpicyPizza/create-envfile@v1\n              with:\n                  envkey_TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}\n                  envkey_TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}\n                  envkey_TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}\n                  envkey_TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}\n                  file_name: .env\n\n            - name: Build the docker container\n              run: docker build .\n\n            - name: Run the script 🚀\n              run: docker-compose up\n```\nNote that you have to create [Action Secrets](https://docs.github.com/en/actions/reference/encrypted-secrets) in your Github Repository (available in the Settings tab) and add the credentials from Step 1.\n\n## Conclusion \n\nAnd that's it! 🐶 \n\nPushing the code to GitHub handles the rest, isn't that wonderful?\n\nAnyways, thanks to my internet friends for the fun idea. I didn't end up sending it to Camilo's phone number because I would have to pay Twilio $0.0075.\n\n---\n*Have some feedback? Feel free to [let me know](https://twitter.com/franciscojarceo)!*"},"nextPost":{"slug":"2021-is-nearly-over","frontmatter":{"title":"2021 is nearly over","description":"Where did the time go?","date":"November 17, 2021"},"excerpt":"","content":"\nIt has been quite an extraordinary year and it has gone by terribly quickly, but I suppose that's a natural part of the aging process.\n\nSo far this year has gone completely differently than I had originally planned but I am grateful for it, it has been quite fun.\n\nReflecting briefly at my goals, which as I listed in my [previous blog](https://franciscojavierarceo.github.io/post/2021-goals) post were:\n\n```\n1. Be a better husband\n2. Talk less, listen more\n3. Cook more intentionally\n4. Speak more intentionally\n5. Help others more effectively\n6. Write at least 2x per month\n7. Exercise ~5x per week\n```\n\nI tried to improve on all of these items over the past year (some significantly more than others), but I'm not where I wanted to be on them.\n\nRegardless, I will say I learned a lot more this year by explicitly trying to improve these things. The goals I found most challengine were (1), (2), (5), and (6). I imagine this is because (1) is hard in general, (2) requires constant mental restraint from speaking up when I want to interject with a response or a thought, (5) doesn't truly realize its effectiveness in short time horizons, and (6) was simply not a priority.\n\nI'm mostly okay with the realities of this except (6), since writing requires being more intentional about my time and thoughts, which disappoints me as it suggests I was more chaotic than I wanted to be. As I grow older I realize how much more important it is to be increasingly more deliberate with the allocation of my time but I always struggle with choosing things as I really do enjoy working on and learning new things.\n\nAnyways, here's to hoping I'm more thoughtful with my time over the next couple of months and years.\n\nCheers,\nFrancisco"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"toxic-bert-and-fast-api"},"buildId":"nGXUnBc2AKxXpYwTG_Vnn","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-fa276ba060a4a8ac7eef.js"></script><script src="/_next/static/chunks/main-39418da170c6bb422e22.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" async=""></script><script src="/_next/static/chunks/commons.a6f6c255f30e2cc8ab2c.js" async=""></script><script src="/_next/static/chunks/pages/_app-56b68b45ae4f06abb5d1.js" async=""></script><script src="/_next/static/chunks/5e7de4f36e438e169c5d145e7df90137ae956f1e.c55db21543619f2e3353.js" async=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-f7cba0a36d81c7b5f6f1.js" async=""></script><script src="/_next/static/nGXUnBc2AKxXpYwTG_Vnn/_buildManifest.js" async=""></script><script src="/_next/static/nGXUnBc2AKxXpYwTG_Vnn/_ssgManifest.js" async=""></script></body></html>